<div class="category-table">
  <h2>Category List</h2>
  <table>
    <thead>
      <tr>
        <th>STUDYID</th>
        <th>DVSPONDES</th>
        <th>DVTERM</th>
        <th></th>
        <th>DVDECOD</th>
        <th>DVCAT</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let category of categories; let i = index">
        <td>{{ category.studyId }}</td>
        <td>{{ category.dvspondesValue }}</td>
        <td>
          <select [(ngModel)]="selectedDvTerm[i]" (change)="onDvTermSelect(i)">
            <option *ngFor="let dvTerm of dvTerms" [value]="dvTerm.dvterm" [selected]="dvTerm.dvterm === selectedDvTerm[i]">
              {{ dvTerm.dvterm }}
            </option>
          </select>
        </td>
        <td>
          <span *ngIf="category.isEdited" style="cursor: pointer;" (click)="openAuditPopup(category.entryId)">ðŸ“…</span>
        </td>
        <td>{{ category.dvdecod }}</td>
        <td>{{ category.dvcat }}</td>
      </tr>
    </tbody>
  </table>
</div>

<div id="audit-popup" class="popup" style="display: none;">
  <div class="popup-content">
    <span class="close" (click)="closeAuditPopup()">&times;</span>
    <h3>Audit Entries</h3>
    <ul>
      <li *ngFor="let entry of auditEntries">
        {{ entry.username }} edited on {{ entry.dateTimeEdited | date:'medium' }}: {{ entry.changeFromTo }}
      </li>
    </ul>
  </div>
</div>
